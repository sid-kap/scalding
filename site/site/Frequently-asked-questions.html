<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
  <meta http-equiv="Content-Style-Type" content="text/css"></meta>
  <meta name="generator" content="pandoc"></meta>
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code &gt; span.kw { color: #007020; font-weight: bold; }
code &gt; span.dt { color: #902000; }
code &gt; span.dv { color: #40a070; }
code &gt; span.bn { color: #40a070; }
code &gt; span.fl { color: #40a070; }
code &gt; span.ch { color: #4070a0; }
code &gt; span.st { color: #4070a0; }
code &gt; span.co { color: #60a0b0; font-style: italic; }
code &gt; span.ot { color: #007020; }
code &gt; span.al { color: #ff0000; font-weight: bold; }
code &gt; span.fu { color: #06287e; }
code &gt; span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="http://localhost:8000/_src/css/bootstrap.min.css" type="text/css"></link>
  <link rel="stylesheet" href="http://localhost:8000/_src/css/custom.css" type="text/css"></link>
</head>
<body>

<div class="row">
    <div class="container">
        <div class="col-xs-4">
            <img id="logo" src="http://localhost:8000//_src/scalding.png">
        </div>
    </div>
</div>

<div class="container">
<div class="row">

<div class="col-xs-3" role="navigation" id="nav-left">
<ul class="nav nav-pills nav-stacked">
    <li role="presentation"><a href="http://localhost:8000/site/.Foo.md.html">.Foo</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/11.html">11</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/_Sidebar.html">_Sidebar</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/API-Reference.html">API-Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Calling-Scalding-from-inside-your-application.html">Calling-Scalding-from-inside-your-application</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Common-Exceptions-and-possible-reasons.html">Common-Exceptions-and-possible-reasons</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Comparison-to-Scrunch-and-Scoobi.html">Comparison-to-Scrunch-and-Scoobi</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Field-rules.html">Field-rules</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Fields-API:-reduce-functions-of-GroupBuilder.html">Fields-API:-reduce-functions-of-GroupBuilder</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Fields-based-API-Reference.html">Fields-based-API-Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Frequently-asked-questions.html">Frequently-asked-questions</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/hello.html">hello</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Home.html">Home</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Introduction-to-Matrix-Library.html">Introduction-to-Matrix-Library</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Matrix-API-Reference.html">Matrix-API-Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Pig-to-Scalding.html">Pig-to-Scalding</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Powered-By.html">Powered-By</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/REPL-Reference.html">REPL-Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Rosetta-Code.html">Rosetta-Code</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Run-in-Intellij-IDEA.html">Run-in-Intellij-IDEA</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scala-and-sbt-for-Homebrew-users.html">Scala-and-sbt-for-Homebrew-users</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scala-and-sbt-for-MacPorts-users.html">Scala-and-sbt-for-MacPorts-users</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scald.rb.html">Scald</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-Commons.html">Scalding-Commons</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-HBase.html">Scalding-HBase</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-on-amazon-elastic-mapreduce.html">Scalding-on-amazon-elastic-mapreduce</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-REPL.html">Scalding-REPL</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-Sources.html">Scalding-Sources</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-with-CDH3U2-in-a-Maven-project.html">Scalding-with-CDH3U2-in-a-Maven-project</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/Aggregation-using-Algebird-Aggregators.html">Aggregation-using-Algebird-Aggregators</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/Alice-in-Wonderland.html">Alice-in-Wonderland</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/Building-bigger-platforms-with-scalding.html">Building-bigger-platforms-with-scalding</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/Getting-Started.html">Getting-Started</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/Intro-to-Scalding-Jobs.html">Intro-to-Scalding-Jobs</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/SQL-to-Scalding.html">SQL-to-Scalding</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Type-safe-api-reference.html">Type-safe-api-reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Upgrading-to-0.9.0.html">Upgrading-to-0</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Using-scalding-with-other-versions-of-scala.html">Using-scalding-with-other-versions-of-scala</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Using-the-distributed-cache.html">Using-the-distributed-cache</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Why-pack-unpack-and-not--toList[].html">Why-pack-unpack-and-not--toList[]</a>
    </li>
    <li role="presentation" class="active"><a href="#"></a></li>
</ul>
</div>

<div class="col-xs-9 text-body">

<div id="TOC">
<ul>
<li><a href="#running-scalding">Running Scalding</a></li>
<li><a href="#writing-jobs">Writing Jobs</a></li>
<li><a href="#issues-with-testing">Issues with Testing</a></li>
<li><a href="#issues-with-sbt">Issues with SBT</a></li>
<li><a href="#contributing-code">Contributing code</a></li>
</ul>
</div>
<p>Feel free to add new questions and to ping <span class="citation">[@Scalding]</span>(http://twitter.com/scalding) for an answer.</p>
<h2 id="running-scalding">Running Scalding</h2>
<h4 id="who-actually-uses-scalding">Who actually uses Scalding?</h4>
<p>Twitter uses it in production all over the place!</p>
<p>Check out our [[Powered By]] page for more examples.</p>
<h4 id="im-having-trouble-with-scald.rb-and-i-just-want-to-run-jars-in-my-own-system">I'm having trouble with scald.rb, and I just want to run jars in my own system:</h4>
<p>See this <a href="https://twitter.com/Joolz/status/264834261549457409">conversation on Twitter</a>.</p>
<h4 id="can-scalding-be-run-on-amazons-elastic-mapreduce">Can Scalding be run on Amazon's Elastic MapReduce?</h4>
<p>Yes! See the <a href="https://groups.google.com/forum/?fromgroups#!topic/cascading-user/5RfJa8n1JPo">cascading-user group discussion</a>. We would like to see someone prepare a patch for scald.rb to handle submission of scalding jobs to EMR.</p>
<h4 id="scalding-complains-when-i-use-a-timepathedsource-and-some-of-the-data-is-missing.-how-can-i-ignore-that-error">Scalding complains when I use a <a href="https://github.com/twitter/scalding/blob/master/src/main/scala/com/twitter/scalding/FileSource.scala#L213">TimePathedSource</a> and some of the data is missing. How can I ignore that error?</h4>
<p>Pass the option <code>--tool.partialok</code> to your job and it will ignore any missing data. It's safer to work around by either filling with place-holder empty files, or writing sources that will skip known-missing dates. Using that option by default is very dangerous.</p>
<h4 id="i-receive-this-error-when-running-sbt-update-error-occurred-during-initialization-of-vm.-incompatible-minimum-and-maximum-heap-sizes-specified">I receive this error when running <code>sbt update</code>: <tt>Error occurred during initialization of VM. Incompatible minimum and maximum heap sizes specified</tt></h4>
<p>In your sbt script, set <code>local min=$(( $mem / 2 ))</code></p>
<h2 id="writing-jobs">Writing Jobs</h2>
<h4 id="how-do-i-perform-windowed-calculations-for-example-moving-average-in-scalding">How do I perform windowed calculations (for example, moving average) in Scalding?</h4>
<p>You want to use <code>GroupBuilder.scanLeft</code>. A <code>scanLeft</code> is like a <code>foldLeft</code> except that you output each intermediate value. Both of these functions are part of the standard Scala library as well. <a href="http://stackoverflow.com/questions/6799441/in-scala-how-do-i-keep-track-of-running-totals-without-using-var">See StackOverflow for <code>scanLeft</code> examples</a>. For the specific example of moving averages in Scalding, see the <a href="https://groups.google.com/forum/?fromgroups#!topic/cascading-user/CTYOjlHs6xE">cascading-user group discussion</a>.</p>
<h4 id="how-do-i-read-a-single-reduced-value-from-a-pipe">How do I read a single reduced value from a pipe?</h4>
<p>You can't do that. Instead you should use RichPipe.crossWithTiny to efficiently do a cartesian product of a small set of values to a larger set. The small set might be a single output, from say <code>pipe.groupAll { _.size }</code>. Alternatively, you might kick off a subsequent job in <code>Job.next</code>, and use <code>Source.readAtSubmitter</code> to read the value before you get going (or even in <code>Job.next</code> to see if you need to kick off the next job).</p>
<h4 id="how-do-i-make-simple-records-for-use-in-my-scalding-job">How do I make simple records for use in my scalding job?</h4>
<p>We recommend cases classes <strong>defined outside of your Job</strong>. Case classes defined inside your job capture an $outer member variable that references the job that is wasteful for serialization. If you have a use case this doesn't cover, email the cascading-user list or mention <span class="citation">[@scalding]</span>(http://twitter.com/scalding). Dealing with serialization issues well in systems like Hadoop is tricky, and we're still improving our approaches.</p>
<p>See the <a href="https://groups.google.com/forum/?fromgroups#!topic/cascading-user/kjpohwyC03Y">discussion on cascading-user</a>.</p>
<h4 id="how-do-i-pass-parameters-to-my-hadoop-job-number-of-reducers-memory-options-etc.">How do I pass parameters to my hadoop job (number of reducers , memory options , etc.) ?</h4>
<pre><code>hadoop jar myjar \
com.twitter.scalding.Tool \
-D mapred.output.compress=false  \
-D mapred.child.java.opts=-Xmx2048m \
-D mapred.reduce.tasks=20 \
com.class.myclass \
--hdfs \
--input $input \
--output $output </code></pre>
<h4 id="how-do-i-access-the-jobconf">How do I access the jobConf?</h4>
<p>If you want to update the jobConf in your job, the way to do it is to override the config method in Job:</p>
<p>https://github.com/twitter/scalding/blob/cee3bb99ebb00db9622c387bee0b2718ab9cea61/scalding-core/src/main/scala/com/twitter/scalding/Job.scala#L163</p>
<p>If you really want to just read from the jobConf, you can do it with code like:</p>
<pre class="sourceCode scala"><code class="sourceCode scala">implicitly[Mode] <span class="kw">match</span> {
  <span class="kw">case</span> <span class="fu">Hdfs</span>(_, configuration) =&gt; {
    <span class="co">// use the configuration which is an instance of Configuration</span>
  }
  <span class="kw">case</span> _ =&gt; <span class="fu">error</span>(<span class="st">&quot;Not running on Hadoop! (maybe cascading local mode?)&quot;</span>)
}</code></pre>
<p>See this discussion: https://groups.google.com/forum/?fromgroups=#!topic/cascading-user/YppTLebWds8</p>
<h4 id="how-do-i-append-my-parameters-to-jobconf">How do I append my parameters to jobConf ?</h4>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">class</span> <span class="fu">WordCountJob</span>(args : Args) <span class="kw">extends</span> <span class="fu">Job</span>(args) {

<span class="co">// Prior to 0.9.0 we need the mode, after 0.9.0 mode is a def on Job.</span>
<span class="kw">override</span> <span class="kw">def</span> <span class="fu">config</span>(<span class="kw">implicit</span> m: Mode): Map[AnyRef,AnyRef] = {
   <span class="kw">super</span>.<span class="fu">config</span> ++ Map (<span class="st">&quot;my.job.name&quot;</span> -&gt; <span class="st">&quot;my new job name&quot;</span>)

  }</code></pre>
<h4 id="what-if-i-have-more-than-22-fields-in-my-data-set">What if I have more than 22 fields in my data-set?</h4>
<p><strong>Warning: this answer refers to the DEPRECATED Fields API.</strong></p>
<p>Many of the examples (e.g. in the <code>tutorial/</code> directory) show that the fields argument is specified as a Scala Tuple when reading a delimited file. However Scala Tuples are currently limited to a maximum of 22 elements. To read-in a data-set with more than 22 fields, you can use a List of Symbols as fields specifier. E.g.</p>
<pre><code>val mySchema = List('first, 'last, 'phone, 'age, 'country)

val input = Csv(&quot;/path/to/file.txt&quot;, separator = &quot;,&quot;, fields = mySchema)
val output = TextLine(&quot;/path/to/out.txt&quot;)
input.read
     .project('age, 'country)
     .write(Tsv(output))</code></pre>
<p>Another way to specify fields is using Scala Enumerations, which is available in the <code>develop</code> branch (as of Apr 2, 2013), as demonstrated in <a href="https://github.com/twitter/scalding/blob/develop/tutorial/Tutorial6.scala">Tutorial 6</a>:</p>
<pre><code>object Schema extends Enumeration {
   val first, last, phone, age, country = Value // arbitrary number of fields
}

import Schema._

Csv(&quot;tutorial/data/phones.txt&quot;, separator = &quot; &quot;, fields = Schema)
  .read
  .project(first,age)
  .write(Tsv(&quot;tutorial/data/output6.tsv&quot;))</code></pre>
<h4 id="how-do-i-increase-the-spill-threshold">How do I increase the spill threshold?</h4>
<p>The spilling is controlled with the same hadoop option as cascading:</p>
<p>-Dcascading.spill.list.threshold=1000000</p>
<p>Would keep 1 million items in memory.</p>
<p>The rule of thumb is use as much as you can without getting OOM.</p>
<h4 id="how-do-i-increase-the-aggregateby-threshold-value">How do I increase the AggregateBy threshold value?</h4>
<p>You can't set a default for AggregateBy, you need to set it in each reducer by calling spillThreshold function on GroupBuilder. https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/GroupBuilder.scala#L97</p>
<h4 id="q.-my-hadoop-job-is-erroring-out-with-abstractmethoderror-or-incompatibleclasschangeerror.">Q. My Hadoop job is erroring out with AbstractMethodError or IncompatibleClassChangeError.</h4>
<p>A. If your job has dependencies that clash with Hadoop's, Hadoop can replace your version of a library (like log4j or ASM) with its own native version. You can fix this with an environment flag that makes sure that your jars show up on the classpath before Hadoop's. Set these environment variables:</p>
<pre><code>bash
export HADOOP_CLASSPATH=&lt;your_jar_file&gt;
export HADOOP_USER_CLASSPATH_FIRST=true</code></pre>
<h4 id="q.-im-getting-a-notserializableexception-on-hadoop-job-submission.">Q. I'm getting a NotSerializableException on Hadoop job submission.</h4>
<p>A. All fields in Job get serialized and sent to Hadoop. Your job contains an object that is not serializable, even with Kryo. This issue may exhibit itself as other exceptions, such as <code>InvocationTargetException</code>, <code>KryoException</code>, or <code>IllegalAccessException</code>. What all these potential exceptions have in common is being related to serialization failures during Hadoop job submission.</p>
<p>First, try to figure out which object is causing the problem.</p>
<p>For a better stacktrace than the usual opaque dump, try submitting your job again with the <code>extendedDebugInfo</code> flag set:</p>
<pre><code>export HADOOP_OPTS=&quot;-Dsun.io.serialization.extendedDebugInfo=true&quot;; hadoop &lt;your-commands&gt;</code></pre>
<p>You should see a much larger stacktrace, with many entries like this:</p>
<pre><code>- field (class &quot;com.twitter.scalding.MapsideReduce&quot;, name: &quot;commutativeSemigroup&quot;, type: &quot;interface com.twitter.algebird.Semigroup&quot;)
- object (class &quot;com.twitter.scalding.MapsideReduce&quot;, MapsideReduce[decl:'key', 'value'])
- field (class &quot;cascading.pipe.Operator&quot;, name: &quot;operation&quot;, type: &quot;interface cascading.operation.Operation&quot;)
- object (class &quot;cascading.pipe.Each&quot;, Each(_pipe_2*_pipe_3)[MapsideReduce[decl:'key', 'value']])
- field (class &quot;org.jgrapht.graph.IntrusiveEdge&quot;, name: &quot;target&quot;, type: &quot;class java.lang.Object&quot;)
- object (class &quot;org.jgrapht.graph.IntrusiveEdge&quot;, org.jgrapht.graph.IntrusiveEdge@6ed95e60)
- custom writeObject data (class &quot;java.util.HashMap&quot;)
- object (class &quot;java.util.LinkedHashMap&quot;, {[{?}:UNKNOWN]</code></pre>
<p>[{?}:UNKNOWN]=org.jgrapht.graph.IntrusiveEdge@6ce4ece3, [{2}:0:1]</p>
<p>Typically, if you start reading from the bottom of these entries upward, the first familiar class you see will be the object that's being unexpectedly serialized and causing you issues. In this case, the error was with Scalding's =MapsideReduce= class.</p>
<p>Once you know which object is causing the problem, try one of the following remedies:</p>
<ol style="list-style-type: decimal">
<li><p>Put the object in a lazy val</p></li>
<li><p>Move it into a companion object, which will not be serialized.</p></li>
<li><p>If the item is only needed at submission, but not on the Mappers/Reducers, make it <code>@transient</code>.</p></li>
</ol>
<p>If you see a common case we overlooked, let us know. Some common issues are inner classes to the Job (don't do that), Logger objects (don't put those in the job, put them in a companion), and some mutable Guava objects have given us trouble (we'd love to see this ticket closed: https://github.com/twitter/chill/issues/66 )</p>
<h2 id="issues-with-testing">Issues with Testing</h2>
<h4 id="how-do-i-get-my-tests-working-with-spec2">How do I get my tests working with Spec2?</h4>
<p>from <span class="citation">[Alex Dean, @alexatkeplar]</span>(https://twitter.com/alexatkeplar)</p>
<p>The problem was in how I was defining my tests. For Scalding, your Specs2 tests must look like this:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="st">&quot;A job which trys to do blah&quot;</span> should {
  &lt;&lt;RUN JOB&gt;&gt;
  <span class="st">&quot;successfully do blah&quot;</span> in {
    expected.<span class="fu">blah</span> must_== actual.<span class="fu">blah</span>
  }
}</code></pre>
<p>My problem was that my tests looked like this:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="st">&quot;A job which trys to do blah&quot;</span> should {
  <span class="st">&quot;successfully do blah&quot;</span> in {
    &lt;&lt;RUN JOB&gt;&gt;
    expected.<span class="fu">blah</span> must_== actual.<span class="fu">blah</span>
  }
}</code></pre>
<p>In other words, running the job was inside the <code>in {}</code>. For some reason, this was leading to multiple jobs running at the same time and conflicting with each others' output.</p>
<p>If anyone is interested, the diff which fixed my tests is here:</p>
<p>https://github.com/snowplow/snowplow/commit/792ed2f9082b871ecedcf36956427a2f0935588c</p>
<h4 id="how-can-i-work-with-hbase-with-scalding">How can I work with HBase with scalding?</h4>
<p>See the [[Scalding HBase]] page.</p>
<h2 id="issues-with-sbt">Issues with SBT</h2>
<ol start="17" style="list-style-type: upper-alpha">
<li><p>What version of SBT do I need? (It'd be great to capture the actual error that happens when you use the wrong version)</p></li>
<li><p>Get SBT 0.12.2. If you're having an older version of SBT, you can update it by typing in command line:</p></li>
</ol>
<p>brew update; brew unlink sbt; brew install sbt</p>
<ol start="17" style="list-style-type: upper-alpha">
<li><p>What happens if I get OutOfMemoryErrors when running &quot;sbt assembly&quot;?</p></li>
<li><p>Create ~/.sbtconfig with these options: SBT_OPTS=&quot;-XX:+UseConcMarkSweepGC -XX:+CMSClassUnloadingEnabled -XX:PermSize=256M -XX:MaxPermSize=512M&quot;</p></li>
<li><p>What should I do if I get &quot;value compare is not a member of object Integer&quot; when running &quot;./sbt compile&quot;?</p></li>
<li><p>You're probably using Java 6 instead of Java 7. You can specify which version of Java SBT should use by passing it the <code>-java-home</code> option. For example, on a Mac you're SBT command might look something like:</p></li>
</ol>
<pre><code>./sbt -java-home /Library/Java/JavaVirtualMachines/&lt;insert folder name of desired JVM version&gt;/Contents/Home/</code></pre>
<h2 id="contributing-code">Contributing code</h2>
<h4 id="do-you-accept-pull-requests">Do you accept pull requests?</h4>
<p>Yes! By requesting a pull, you are agreeing to license your code under the same license as Scalding.</p>
<h4 id="to-which-branch-do-i-make-my-pull-request">To which branch do I make my pull request?</h4>
<p><a href="https://github.com/twitter/scalding/tree/develop">develop</a></p>

</div>

</div>
</div>

</body>
</html>

