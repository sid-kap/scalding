<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
  <meta http-equiv="Content-Style-Type" content="text/css"></meta>
  <meta name="generator" content="pandoc"></meta>
  <title>Intro to Scalding Jobs</title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="http://localhost:8000/_src/css/bootstrap.min.css" type="text/css"></link>
  <link rel="stylesheet" href="http://localhost:8000/_src/css/custom.css" type="text/css"></link>
  <style type="text/css">
    table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
      margin: 0; padding: 0; vertical-align: baseline; border: none; }
    table.sourceCode { width: 100%; line-height: 100%; }
    td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
    td.sourceCode { padding-left: 5px; }
    code > span.kw { color: #007020; font-weight: bold; }
    code > span.dt { color: #902000; }
    code > span.dv { color: #40a070; }
    code > span.bn { color: #40a070; }
    code > span.fl { color: #40a070; }
    code > span.ch { color: #4070a0; }
    code > span.st { color: #4070a0; }
    code > span.co { color: #60a0b0; font-style: italic; }
    code > span.ot { color: #007020; }
    code > span.al { color: #ff0000; font-weight: bold; }
    code > span.fu { color: #06287e; }
    code > span.er { color: #ff0000; font-weight: bold; }
  </style>
</head>
<body>

<div class="row">
    <div class="container">
        <div class="col-xs-4">
            <img id="logo" src="http://localhost:8000//_src/scalding.png">
        </div>
    </div>
</div>

<div class="container">
<div class="row">

<div class="col-xs-3" role="navigation" id="nav-left">
    
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/.Foo.md.html">.Foo.md</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/11.html"></a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Home.html">Home</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/_Sidebar.html">_Sidebar</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/hello.html">hello</a>
    </li>
    </ul>
    Tutorials > Beginner
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/01-Beginner/01-Getting-Started.html">Getting Started</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/01-Beginner/02-Alice-in-Wonderland.html">Alice in Wonderland</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/01-Beginner/03-Intro-to-Scalding-Jobs.html">Intro to Scalding Jobs</a>
    </li>
    </ul>
    Tutorials > Intermediate
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/02-Intermediate/Aggregation-using-Algebird-Aggregators.html">Aggregation using Algebird Aggregators</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/02-Intermediate/SQL-to-Scalding.html">SQL to Scalding</a>
    </li>
    </ul>
    Tutorials > Advanced
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/03-Advanced/Building-bigger-platforms-with-scalding.html">Building bigger platforms with scalding</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/03-Advanced/Introduction-to-Matrix-Library.html">Introduction to Matrix Library</a>
    </li>
    </ul>
    Reference
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/02-Reference/API-Reference.html">API Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Calling-Scalding-from-Inside-Your-Application.html">Calling Scalding from Inside Your Application</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Common-Exceptions-and-Possible-Reasons.html">Common Exceptions and Possible Reasons</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Frequently-asked-questions.html">Frequently asked questions</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Matrix-API-Reference.html">Matrix API Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Pig-to-Scalding.html">Pig to Scalding</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/REPL-Reference.html">REPL Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Rosetta-Code.html">Rosetta Code</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Scald.rb.html">Scald.rb</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Scalding-Commons.html">Scalding Commons</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Scalding-HBase.html">Scalding HBase</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Scalding-REPL.html">Scalding REPL</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Scalding-Sources.html">Scalding Sources</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Type-safe-api-reference.html">Type safe api reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Using-scalding-with-other-versions-of-scala.html">Using scalding with other versions of scala</a>
    </li>
    </ul>
    Reference > Fields API (Deprecated)
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/02-Reference/01-Fields-API-(Deprecated)/Fields-API:-reduce-functions-of-GroupBuilder.html">Fields API: reduce functions of GroupBuilder</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/01-Fields-API-(Deprecated)/Fields-based-API-Reference.html">Fields based API Reference</a>
    </li>
    </ul>
    Other
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/03-Other/Comparison-to-Scrunch-and-Scoobi.html">Comparison to Scrunch and Scoobi</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Field-rules.html">Field rules</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Powered-By.html">Powered By</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Run-in-Intellij-IDEA.html">Run in Intellij IDEA</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Scala-and-sbt-for-Homebrew-users.html">Scala and sbt for Homebrew users</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Scala-and-sbt-for-MacPorts-users.html">Scala and sbt for MacPorts users</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Scalding-on-amazon-elastic-mapreduce.html">Scalding on amazon elastic mapreduce</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Scalding-with-CDH3U2-in-a-Maven-project.html">Scalding with CDH3U2 in a Maven project</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Upgrading-to-0.9.0.html">Upgrading to 0.9.0</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Using-the-distributed-cache.html">Using the distributed cache</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Why-pack-unpack-and-not--toList[].html">Why pack unpack and not  toList[]</a>
    </li>
    </ul>
</div>

<div class="col-xs-0 col-md-1"></div>

<div class="col-xs-9 col-md-8 text-body">

<div id="header">
<h1 class="title">Intro to Scalding Jobs</h1>
</div>
<div id="TOC">
<ul>
<li><a href="#wordcount-in-scalding">WordCount in Scalding</a></li>
<li><a href="#wordcount-dissection">WordCount dissection</a></li>
<li><a href="#next-steps">Next Steps</a></li>
</ul>
</div>
<h3 id="wordcount-in-scalding">WordCount in Scalding</h3>
<p>Let's look at a simple WordCount job.</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">import</span> com.<span class="fu">twitter</span>.<span class="fu">scalding</span>.<span class="fu">_</span>

<span class="kw">class</span> <span class="fu">WordCountJob</span>(args: Args) <span class="kw">extends</span> <span class="fu">Job</span>(args) {
  TypedPipe.<span class="fu">from</span>(<span class="fu">TextLine</span>(<span class="fu">args</span>(<span class="st">"input"</span>)))
    .<span class="fu">flatMap</span> { line => line.<span class="fu">split</span>(<span class="st">"""\s+"""</span>) }
    .<span class="fu">groupBy</span> { word => word }
    .<span class="fu">size</span>
    .<span class="fu">write</span>(<span class="fu">TypedTsv</span>(<span class="fu">args</span>(<span class="st">"output"</span>)))
}</code></pre>
<p>This job reads in a file, emits every word in a line, counts the occurrences of each word, and writes these word-count pairs to a tab-separated file.</p>
<p>To run the job, copy the source code above into a <code>WordCountJob.scala</code> file, create a file named <code>someInputfile.txt</code> containing some arbitrary text, and then enter the following command from the root of the Scalding repository:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">scripts/scald.rb</span> --local WordCountJob.scala --input someInputfile.txt --output ./someOutputFile.tsv</code></pre>
<p>This runs the WordCount job in <em>local</em> mode (i.e., not on a Hadoop cluster). After a few seconds, your first Scalding job should be done!</p>
<h3 id="wordcount-dissection">WordCount dissection</h3>
<p>Let's take a closer look at the job.</p>
<h4 id="textline">TextLine</h4>
<p><code>TextLine</code> is an example of a Scalding <a href="http://www.cascading.org/1.2/userguide/html/ch03s03.html">source</a> that reads each line of a file into a field named <code>line</code>.</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="fu">TextLine</span>(<span class="fu">args</span>(<span class="st">"input"</span>)) <span class="co">// args("input") contains a filename to read from</span></code></pre>
<p>Another common source is a <code>TypedTsv</code> source that reads tab-delimited files. You can also create sources that read directly from LZO-compressed files on HDFS (possibly containing Protobuf- or Thrift-encoded objects!), or even database sources that read directly from a MySQL table. See the scalding-commons module for lzo, thrift and protobuf support. Also see scalding-avro if you use avro.</p>
<h4 id="flatmap">flatMap</h4>
<p><code>flatMap</code> is an example of a function that you can apply to a stream of tuples.</p>
<pre class="sourceCode scala"><code class="sourceCode scala">TypedPipe.<span class="fu">from</span>(<span class="fu">TextLine</span>(<span class="fu">args</span>(<span class="st">"input"</span>)))
  <span class="co">// flat map the "line" field to a new words separated by one or more space</span>
  .<span class="fu">flatMap</span> { line => line.<span class="fu">split</span>(<span class="st">"""\s+"""</span>) }</code></pre>
<p>The above works just like calling flatMap on a List in scala.</p>
<p>Our tuple stream now contains something like the following:</p>
<pre><code>input             output
this is a line    this
line 2            is
                  a
                  line
                  line
                  2</code></pre>
<p>See the [[Type-safe api reference]] for more examples of <code>flatMap</code> (including how to flat map from and to multiple fields), as well as examples of other functions you can apply to a tuple stream.</p>
<h4 id="groupby">groupBy</h4>
<p>Next, we group the same words together, and count the size of each group.</p>
<pre class="sourceCode scala"><code class="sourceCode scala">TypedPipe.<span class="fu">from</span>(<span class="fu">TextLine</span>(<span class="fu">args</span>(<span class="st">"input"</span>)))
  .<span class="fu">flatMap</span> { line => line.<span class="fu">split</span>(<span class="st">"""\s+"""</span>) }
  .<span class="fu">groupBy</span> { word => word }
  .<span class="fu">size</span></code></pre>
<p>Here, we group the stream into groups of tuples with the same <code>word</code>, and then we make the value for each keyed group the size of that group.</p>
<p>The tuple stream now looks like:</p>
<pre><code>(line, 2)
(this, 1)
(is, 1)
...</code></pre>
<p>Again, see the [[Type-safe api reference]] for more examples of grouping functions.</p>
<h4 id="write-tsv">write, Tsv</h4>
<p>Finally, just as we read from a <code>TextLine</code> source, we can also output our computations to a <code>TypedTsv</code> source. A TypedTsv can see the types it is putting in each column. We could write <code>TypedTsv[(String, Long)]</code> below to be sure we are writing what we intend, but scala can usually infer the types if we leave them off (though, when you get in trouble, try adding the types near the compilation error and see if you can get a better message as to what is going on).</p>
<pre class="sourceCode scala"><code class="sourceCode scala">  TypedPipe.<span class="fu">from</span>(<span class="fu">TextLine</span>(<span class="fu">args</span>(<span class="st">"input"</span>)))
    .<span class="fu">flatMap</span> { line => line.<span class="fu">split</span>(<span class="st">"""\s+"""</span>) }
    .<span class="fu">groupBy</span> { word => word }
    .<span class="fu">size</span>
    .<span class="fu">write</span>(<span class="fu">TypedTsv</span>(<span class="fu">args</span>(<span class="st">"output"</span>)))</code></pre>
<h4 id="scald.rb">scald.rb</h4>
<p>The <code>scald.rb</code> script in the <code>scripts/</code> directory is a handy script that makes it easy to run jobs in both local mode or on a remote Hadoop cluster. It handles simple command-line parsing, and copies over necessary JAR files when running remote jobs.</p>
<p>If you're running many Scalding jobs, it can be useful to add <code>scald.rb</code> to your path, so that you don't need to provide the absolute pathname every time. One way of doing this is via (something like):</p>
<pre><code>ln -s scripts/scald.rb $HOME/bin/</code></pre>
<p>This creates a symlink to the <code>scald.rb</code> script in your <code>$HOME/bin/</code> directory (which should already be included in your PATH).</p>
<p>See [<a href="#scald.rb">scald.rb</a>] for more information, including instructions on how to set up the script to run jobs remotely.</p>
<h3 id="next-steps">Next Steps</h3>
<p>You now know the basics of Scalding! To learn more, check out the following resources:</p>
<ul>
<li>REPL Example: Try the <a href="https://gist.github.com/johnynek/a47699caa62f4f38a3e2">Alice in Wonderland walkthrough</a> which shows how to use Scalding step by step to learn about the book's text.</li>
<li><a href="https://github.com/twitter/scalding/tree/master/tutorial">tutorial/</a>: this folder contains an introductory series of runnable jobs.</li>
<li>[[API Reference]]: includes code snippets explaining different kinds of Scalding functions (e.g., map, filter, project, groupBy, join) and much more.</li>
<li></li>
<li><a href="https://github.com/willf/scalding_cookbook">Cookbook</a>: Short recipes for common tasks.</li>
</ul>

</div>

</div>
</div>

</body>
</html>
