<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
  <meta http-equiv="Content-Style-Type" content="text/css"></meta>
  <meta name="generator" content="pandoc"></meta>
  <title>SQL to Scalding</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code &gt; span.kw { color: #007020; font-weight: bold; }
code &gt; span.dt { color: #902000; }
code &gt; span.dv { color: #40a070; }
code &gt; span.bn { color: #40a070; }
code &gt; span.fl { color: #40a070; }
code &gt; span.ch { color: #4070a0; }
code &gt; span.st { color: #4070a0; }
code &gt; span.co { color: #60a0b0; font-style: italic; }
code &gt; span.ot { color: #007020; }
code &gt; span.al { color: #ff0000; font-weight: bold; }
code &gt; span.fu { color: #06287e; }
code &gt; span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="http://localhost:8000/_src/css/bootstrap.min.css" type="text/css"></link>
  <link rel="stylesheet" href="http://localhost:8000/_src/css/custom.css" type="text/css"></link>
</head>
<body>

<div class="row">
    <div class="container">
        <div class="col-xs-4">
            <img id="logo" src="http://localhost:8000//_src/scalding.png">
        </div>
    </div>
</div>

<div class="container">
<div class="row">

<div class="col-xs-3" role="navigation" id="nav-left">
<ul class="nav nav-pills nav-stacked">
    <li role="presentation"><a href="http://localhost:8000/site/.Foo.md.html">.Foo</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/11.html">11</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/_Sidebar.html">_Sidebar</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/API-Reference.html">API-Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Calling-Scalding-from-inside-your-application.html">Calling-Scalding-from-inside-your-application</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Common-Exceptions-and-possible-reasons.html">Common-Exceptions-and-possible-reasons</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Comparison-to-Scrunch-and-Scoobi.html">Comparison-to-Scrunch-and-Scoobi</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Field-rules.html">Field-rules</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Fields-API:-reduce-functions-of-GroupBuilder.html">Fields-API:-reduce-functions-of-GroupBuilder</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Fields-based-API-Reference.html">Fields-based-API-Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Frequently-asked-questions.html">Frequently-asked-questions</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/hello.html">hello</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Home.html">Home</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Introduction-to-Matrix-Library.html">Introduction-to-Matrix-Library</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Matrix-API-Reference.html">Matrix-API-Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Pig-to-Scalding.html">Pig-to-Scalding</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Powered-By.html">Powered-By</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/REPL-Reference.html">REPL-Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Rosetta-Code.html">Rosetta-Code</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Run-in-Intellij-IDEA.html">Run-in-Intellij-IDEA</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scala-and-sbt-for-Homebrew-users.html">Scala-and-sbt-for-Homebrew-users</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scala-and-sbt-for-MacPorts-users.html">Scala-and-sbt-for-MacPorts-users</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scald.rb.html">Scald</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-Commons.html">Scalding-Commons</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-HBase.html">Scalding-HBase</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-on-amazon-elastic-mapreduce.html">Scalding-on-amazon-elastic-mapreduce</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-REPL.html">Scalding-REPL</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-Sources.html">Scalding-Sources</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-with-CDH3U2-in-a-Maven-project.html">Scalding-with-CDH3U2-in-a-Maven-project</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/Aggregation-using-Algebird-Aggregators.html">Aggregation-using-Algebird-Aggregators</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/Alice-in-Wonderland.html">Alice-in-Wonderland</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/Building-bigger-platforms-with-scalding.html">Building-bigger-platforms-with-scalding</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/Getting-Started.html">Getting-Started</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/Intro-to-Scalding-Jobs.html">Intro-to-Scalding-Jobs</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/SQL-to-Scalding.html">SQL-to-Scalding</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Type-safe-api-reference.html">Type-safe-api-reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Upgrading-to-0.9.0.html">Upgrading-to-0</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Using-scalding-with-other-versions-of-scala.html">Using-scalding-with-other-versions-of-scala</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Using-the-distributed-cache.html">Using-the-distributed-cache</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Why-pack-unpack-and-not--toList[].html">Why-pack-unpack-and-not--toList[]</a>
    </li>
    <li role="presentation" class="active"><a href="#">SQL to Scalding</a></li>
</ul>
</div>

<div class="col-xs-9 text-body">

<div id="header">
<h1 class="title">SQL to Scalding</h1>
</div>
<div id="TOC">
<ul>
<li><a href="#motivation">Motivation</a></li>
<li><a href="#create-datasets">Create datasets</a></li>
<li><a href="#simple-count">Simple Count</a></li>
<li><a href="#count-distinct">Count distinct</a></li>
<li><a href="#count-count-distinct-sum-in-one-query">Count, Count distinct, Sum in one query</a></li>
<li><a href="#where">Where</a></li>
<li><a href="#order-by-x-y-limit-n">Order by X, Y limit N</a></li>
<li><a href="#union">Union</a></li>
<li><a href="#group-and-aggregate">Group and Aggregate</a></li>
<li><a href="#join">Join</a></li>
<li><a href="#histogram-ntile">Histogram, Ntile</a></li>
<li><a href="#todo">TODO</a></li>
</ul>
</div>
<h3 id="motivation">Motivation</h3>
<p>SQL is a popular language for data analytics. Scalding is a relative newcomer that is more powerful and complex. The goal of this document is to translate commonly used SQL idioms to the Scalding type-safe API (which is preferred over the fields-based API). We are using Vertica SQL variant that is based on PSQL and has support for analytic functions. We have purposely picked trivial example datasets so that it is easy to experiment using the REPL and view intermediate results to get a better understanding of what each method does. More information on how to use the REPL is in [[Scalding REPL]] and <a href="https://gist.github.com/johnynek/a47699caa62f4f38a3e2">Learning Scalding with Alice</a>.</p>
<p>Prerequisites:</p>
<ul>
<li>Elementary knowledge of Scala</li>
<li>Basic ability to decipher types in Scalding methods</li>
</ul>
<p>You should not expect Scalding to be as intuitive as SQL, but at the same time it is not as hard as it may seem when you see the plethora of classes and methods in the Scalding docs.</p>
<p>To get a deeper understanding of monoids like QTree, please see <a href="https://github.com/twitter/algebird/wiki/Learning-Algebird-Monoids-with-REPL">Learning Algebird Monoids with REPL</a></p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">import</span> com.<span class="fu">twitter</span>.<span class="fu">scalding</span>.<span class="fu">_</span>
<span class="kw">import</span> com.<span class="fu">twitter</span>.<span class="fu">scalding</span>.<span class="fu">ReplImplicits</span>.<span class="fu">_</span>
<span class="kw">import</span> com.<span class="fu">twitter</span>.<span class="fu">scalding</span>.<span class="fu">ReplImplicitContext</span>.<span class="fu">_</span></code></pre>
<h3 id="create-datasets">Create datasets</h3>
<p><strong>SQL</strong></p>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CREATE</span> <span class="kw">TABLE</span> test.allsales(
  state <span class="dt">VARCHAR</span>(<span class="dv">20</span>),
  name <span class="dt">VARCHAR</span>(<span class="dv">20</span>),
  sales <span class="dt">INT</span>
);

<span class="kw">INSERT</span> <span class="kw">INTO</span> test.allsales <span class="kw">VALUES</span>(<span class="st">'CA'</span>, <span class="st">'A'</span>, <span class="dv">60</span>);
<span class="kw">INSERT</span> <span class="kw">INTO</span> test.allsales <span class="kw">VALUES</span>(<span class="st">'CA'</span>, <span class="st">'A'</span>, <span class="dv">20</span>);
<span class="kw">INSERT</span> <span class="kw">INTO</span> test.allsales <span class="kw">VALUES</span>(<span class="st">'VA'</span>, <span class="st">'B'</span>, <span class="dv">15</span>);
<span class="kw">COMMIT</span>;

pwagle=&gt; <span class="kw">select</span> * <span class="kw">from</span> test.allsales;
 state | name | sales
<span class="co">-------+------+-------</span>
 CA    | A    |    <span class="dv">60</span>
 VA    | B    |    <span class="dv">15</span>
 CA    | A    |    <span class="dv">20</span>
(<span class="dv">3</span> <span class="kw">rows</span>)</code></pre>
<p><strong>Scalding</strong></p>
<pre class="sourceCode scala"><code class="sourceCode scala">scala&gt; <span class="kw">case</span> <span class="kw">class</span> <span class="fu">Sale</span>(state: String, name: String, sale: Int)
defined <span class="kw">class</span> Sale

scala&gt; <span class="kw">val</span> salesList = List(<span class="fu">Sale</span>(<span class="st">&quot;CA&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="dv">60</span>), <span class="fu">Sale</span>(<span class="st">&quot;CA&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="dv">20</span>), <span class="fu">Sale</span>(<span class="st">&quot;VA&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="dv">15</span>))
salesList: List[Sale] = List(<span class="fu">Sale</span>(CA,A,<span class="dv">60</span>), <span class="fu">Sale</span>(CA,A,<span class="dv">20</span>), <span class="fu">Sale</span>(VA,B,<span class="dv">15</span>))

scala&gt; <span class="kw">val</span> salesPipe = TypedPipe.<span class="fu">from</span>(salesList)
salesPipe: com.<span class="fu">twitter</span>.<span class="fu">scalding</span>.<span class="fu">typed</span>.<span class="fu">TypedPipe</span>[Sale] = <span class="fu">IterablePipe</span>(List(<span class="fu">Sale</span>(CA,A,<span class="dv">60</span>), <span class="fu">Sale</span>(CA,A,<span class="dv">20</span>), <span class="fu">Sale</span>(VA,B,<span class="dv">15</span>)))</code></pre>
<h3 id="simple-count">Simple Count</h3>
<p><strong>SQL</strong></p>
<pre class="sourceCode sql"><code class="sourceCode sql">pwagle=&gt; <span class="kw">select</span> <span class="fu">count</span>(<span class="dv">1</span>) <span class="kw">from</span> test.allsales;
 <span class="fu">count</span>
<span class="co">-------</span>
     <span class="dv">3</span></code></pre>
<p><strong>Scalding</strong></p>
<pre class="sourceCode scala"><code class="sourceCode scala">scala&gt; salesPipe.<span class="fu">groupAll</span>.<span class="fu">size</span>.<span class="fu">values</span>.<span class="fu">dump</span>
<span class="dv">3</span></code></pre>
<h3 id="count-distinct">Count distinct</h3>
<p><strong>SQL</strong></p>
<pre class="sourceCode sql"><code class="sourceCode sql">pwagle=&gt; <span class="kw">select</span> <span class="fu">count</span>(<span class="kw">distinct</span> state) <span class="kw">from</span> test.allsales;
 <span class="fu">count</span>
<span class="co">-------</span>
     <span class="dv">2</span></code></pre>
<p><strong>Scalding</strong></p>
<pre class="sourceCode scala"><code class="sourceCode scala">scala&gt; salesPipe.<span class="fu">map</span>{ _.<span class="fu">state</span> }.<span class="fu">distinct</span>.<span class="fu">groupAll</span>.<span class="fu">size</span>.<span class="fu">values</span>.<span class="fu">dump</span>
<span class="dv">2</span></code></pre>
<h3 id="count-count-distinct-sum-in-one-query">Count, Count distinct, Sum in one query</h3>
<p><strong>SQL</strong></p>
<pre class="sourceCode sql"><code class="sourceCode sql">pwagle=&gt; <span class="kw">select</span> <span class="fu">count</span>(<span class="dv">1</span>), <span class="fu">count</span>(<span class="kw">distinct</span> state), <span class="fu">sum</span>(sales) <span class="kw">from</span> test.allsales;
 <span class="fu">count</span> | <span class="fu">count</span> | <span class="fu">sum</span>
<span class="co">-------+-------+-----</span>
     <span class="dv">3</span> |     <span class="dv">2</span> |  <span class="dv">95</span></code></pre>
<p><strong>Scalding</strong></p>
<pre class="sourceCode scala"><code class="sourceCode scala">scala&gt; {
     |   salesPipe.<span class="fu">map</span>{x =&gt; (<span class="dv">1</span>, Set(x.<span class="fu">state</span>), x.<span class="fu">sale</span>) }
     |            .<span class="fu">groupAll</span>
     |            .<span class="fu">sum</span>
     |            .<span class="fu">values</span>
     |            .<span class="fu">map</span>{ <span class="kw">case</span>(count, set, sum) =&gt; (count, set.<span class="fu">size</span>, sum) }
     |            .<span class="fu">dump</span>
     | }
(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">95</span>)</code></pre>
<p>The above query will have performance issues if count(distinct state) is large. This can be solved in two ways:</p>
<ul>
<li>Group by state first (TODO)</li>
<li>Using an approximate data structure like HyperLogLog (TODO)</li>
</ul>
<p>Also see [[Aggregation using Algebird Aggregators]].</p>
<h3 id="where">Where</h3>
<p><strong>SQL</strong></p>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> state, name, sales
<span class="kw">from</span> test.allsales
<span class="kw">where</span>
state = <span class="st">'CA'</span>;</code></pre>
<p><strong>Scalding</strong></p>
<pre class="sourceCode scala"><code class="sourceCode scala">scala&gt; salesPipe.<span class="fu">filter</span>(sale =&gt; (sale.<span class="fu">state</span> == <span class="st">&quot;CA&quot;</span>)).<span class="fu">dump</span>
<span class="fu">Sale</span>(CA,A,<span class="dv">60</span>)
<span class="fu">Sale</span>(CA,A,<span class="dv">20</span>)</code></pre>
<h3 id="order-by-x-y-limit-n">Order by X, Y limit N</h3>
<p><strong>SQL</strong></p>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> state, name, sale
<span class="kw">from</span> test.allsales
<span class="kw">order</span> <span class="kw">by</span> state, name
<span class="kw">limit</span> <span class="dv">1</span>;</code></pre>
<p><strong>Scalding</strong></p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">object</span> SaleOrderingWithState <span class="kw">extends</span> Ordering[Sale] {
  <span class="kw">def</span> <span class="fu">compare</span>(a: Sale, b: Sale) = a.<span class="fu">state</span> compare b.<span class="fu">state</span>
}

<span class="kw">implicit</span> <span class="kw">val</span> saleOrderingWithState = SaleOrderingWithState</code></pre>
<pre class="sourceCode scala"><code class="sourceCode scala">scala&gt; salesPipe.<span class="fu">groupAll</span>.<span class="fu">sorted</span>.<span class="fu">values</span>.<span class="fu">dump</span>
<span class="fu">Sale</span>(CA,A,<span class="dv">60</span>)
<span class="fu">Sale</span>(CA,A,<span class="dv">20</span>)
<span class="fu">Sale</span>(VA,B,<span class="dv">15</span>)

scala&gt; salesPipe.<span class="fu">groupAll</span>.<span class="fu">sorted</span>.<span class="fu">take</span>(<span class="dv">1</span>).<span class="fu">values</span>.<span class="fu">dump</span>
<span class="fu">Sale</span>(CA,A,<span class="dv">20</span>)

scala&gt; salesPipe.<span class="fu">groupAll</span>.<span class="fu">sortedTake</span>(<span class="dv">1</span>).<span class="fu">values</span>.<span class="fu">dump</span>
List(<span class="fu">Sale</span>(CA,A,<span class="dv">20</span>))</code></pre>
<h3 id="union">Union</h3>
<p><strong>SQL</strong></p>
<pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">select</span> state, name, sales <span class="kw">from</span> test.allsales
<span class="kw">UNION</span> <span class="kw">ALL</span>
<span class="kw">select</span> state, name, sales <span class="kw">from</span> test.allsales2</code></pre>
<p><strong>Scalding</strong></p>
<pre class="sourceCode scala"><code class="sourceCode scala">scala&gt; <span class="kw">val</span> salesPipe1 = TypedPipe.<span class="fu">from</span>(salesList)
salesPipe1: com.<span class="fu">twitter</span>.<span class="fu">scalding</span>.<span class="fu">typed</span>.<span class="fu">TypedPipe</span>[Sale] = <span class="fu">IterablePipe</span>(List(<span class="fu">Sale</span>(CA,A,<span class="dv">60</span>), <span class="fu">Sale</span>(CA,A,<span class="dv">20</span>), <span class="fu">Sale</span>(VA,B,<span class="dv">15</span>)))

scala&gt; <span class="kw">val</span> salesPipe2 = TypedPipe.<span class="fu">from</span>(salesList)
salesPipe2: com.<span class="fu">twitter</span>.<span class="fu">scalding</span>.<span class="fu">typed</span>.<span class="fu">TypedPipe</span>[Sale] = <span class="fu">IterablePipe</span>(List(<span class="fu">Sale</span>(CA,A,<span class="dv">60</span>), <span class="fu">Sale</span>(CA,A,<span class="dv">20</span>), <span class="fu">Sale</span>(VA,B,<span class="dv">15</span>)))

scala&gt; (salesPipe1 ++ salesPipe2).<span class="fu">dump</span>
<span class="fu">Sale</span>(CA,A,<span class="dv">60</span>)
<span class="fu">Sale</span>(CA,A,<span class="dv">20</span>)
<span class="fu">Sale</span>(VA,B,<span class="dv">15</span>)
<span class="fu">Sale</span>(CA,A,<span class="dv">60</span>)
<span class="fu">Sale</span>(CA,A,<span class="dv">20</span>)
<span class="fu">Sale</span>(VA,B,<span class="dv">15</span>)</code></pre>
<h3 id="group-and-aggregate">Group and Aggregate</h3>
<p><strong>SQL</strong></p>
<pre class="sourceCode sql"><code class="sourceCode sql">pwagle=&gt; <span class="kw">select</span> state, <span class="fu">count</span>(<span class="dv">1</span>), <span class="fu">count</span>(<span class="kw">distinct</span> name), <span class="fu">sum</span>(sales)
pwagle-&gt; <span class="kw">from</span> test.allsales
pwagle-&gt; <span class="kw">group</span> <span class="kw">by</span> state;
 state | <span class="fu">count</span> | <span class="fu">count</span> | <span class="fu">sum</span>
<span class="co">-------+-------+-------+-----</span>
 CA    |     <span class="dv">2</span> |     <span class="dv">1</span> |  <span class="dv">80</span>
 VA    |     <span class="dv">1</span> |     <span class="dv">1</span> |  <span class="dv">15</span></code></pre>
<p><strong>Scalding</strong></p>
<pre class="sourceCode scala"><code class="sourceCode scala">scala&gt; {
     |   salesPipe.<span class="fu">map</span>{ x =&gt; (x.<span class="fu">state</span>, (<span class="dv">1</span>, Set(x.<span class="fu">name</span>), x.<span class="fu">sale</span>)) }
     |            .<span class="fu">group</span>
     |            .<span class="fu">sum</span>
     |            .<span class="fu">dump</span>
     | }
(CA,(<span class="dv">2</span>,Set(A),<span class="dv">80</span>))
(VA,(<span class="dv">1</span>,Set(B),<span class="dv">15</span>))

scala&gt; {
     |   salesPipe.<span class="fu">map</span>{ x =&gt; (x.<span class="fu">state</span>, (<span class="dv">1</span>, Set(x.<span class="fu">name</span>), x.<span class="fu">sale</span>)) }
     |      .<span class="fu">group</span>
     |      .<span class="fu">sum</span>
     |      .<span class="fu">map</span>{ <span class="kw">case</span> (state, (count, set, sum)) =&gt; (state, (count, set.<span class="fu">size</span>, sum))}
     |      .<span class="fu">dump</span>
     | }
(CA,(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">80</span>))
(VA,(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">15</span>))</code></pre>
<h3 id="join">Join</h3>
<p><strong>Scalding</strong></p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">case</span> <span class="kw">class</span> <span class="fu">Table1Row</span>(field1: String, val1: Int)
<span class="kw">case</span> <span class="kw">class</span> <span class="fu">Table2Row</span>(field2: String, val2: Int)

<span class="kw">val</span> table1 = TypedPipe.<span class="fu">from</span>(List(
    <span class="fu">Table1Row</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">1</span>),
    <span class="fu">Table1Row</span>(<span class="st">&quot;b&quot;</span>, <span class="dv">2</span>)))
<span class="kw">val</span> table2 = TypedPipe.<span class="fu">from</span>(List(
    <span class="fu">Table2Row</span>(<span class="st">&quot;b&quot;</span>, <span class="dv">3</span>),
    <span class="fu">Table2Row</span>(<span class="st">&quot;c&quot;</span>, <span class="dv">4</span>)))

<span class="kw">val</span> table1Group = table1.<span class="fu">groupBy</span> { _.<span class="fu">field1</span> }
<span class="kw">val</span> table2Group = table2.<span class="fu">groupBy</span> { _.<span class="fu">field2</span> }

<span class="kw">val</span> join = table1Group.<span class="fu">join</span>(table2Group)</code></pre>
<pre class="sourceCode scala"><code class="sourceCode scala">scala&gt; join.<span class="fu">dump</span>
(b,(<span class="fu">Table1Row</span>(b,<span class="dv">2</span>),<span class="fu">Table2Row</span>(b,<span class="dv">3</span>)))</code></pre>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> leftJoin = table1Group.<span class="fu">leftJoin</span>(table2Group)
<span class="kw">val</span> outerJoin = table1Group.<span class="fu">outerJoin</span>(table2Group)</code></pre>
<pre class="sourceCode scala"><code class="sourceCode scala">scala&gt; leftJoin.<span class="fu">dump</span>
(a,(<span class="fu">Table1Row</span>(a,<span class="dv">1</span>),None))
(b,(<span class="fu">Table1Row</span>(b,<span class="dv">2</span>),Some(<span class="fu">Table2Row</span>(b,<span class="dv">3</span>))))

scala&gt; outerJoin.<span class="fu">dump</span>
(a,(Some(<span class="fu">Table1Row</span>(a,<span class="dv">1</span>)),None))
(b,(Some(<span class="fu">Table1Row</span>(b,<span class="dv">2</span>)),Some(<span class="fu">Table2Row</span>(b,<span class="dv">3</span>))))
(c,(None,Some(<span class="fu">Table2Row</span>(c,<span class="dv">4</span>))))</code></pre>
<h3 id="histogram-ntile">Histogram, Ntile</h3>
<p><strong>SQL</strong></p>
<pre class="sourceCode sql"><code class="sourceCode sql">TODO</code></pre>
<p><strong>Scalding Histogram Fields-based Only</strong></p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> inputTp: TypedPipe[Int] = TypedPipe.<span class="fu">from</span>(List(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">30</span>))
<span class="kw">val</span> p = inputTp.<span class="fu">toPipe</span>(('value))
<span class="kw">val</span> p1 = p.<span class="fu">groupAll</span> { group =&gt; group.<span class="fu">histogram</span>('value -&gt; 'histogram) }
  .<span class="fu">map</span>('histogram -&gt; ('min, 'q1, 'median, 'q3, 'max, 'mean)) {
     x: Histogram =&gt; (x.<span class="fu">min</span>, x.<span class="fu">q1</span>, x.<span class="fu">median</span>, x.<span class="fu">q3</span>, x.<span class="fu">max</span>, x.<span class="fu">mean</span>)
   }
<span class="kw">val</span> outputTp = p1.<span class="fu">toTypedPipe</span>[(Double, Double, Double, Double, Double, Double)](('min, 'q1, 'median, 'q3, 'max, 'mean))
outputTp.<span class="fu">dump</span>
(<span class="fl">1.0</span>,<span class="fl">3.0</span>,<span class="fl">4.0</span>,<span class="fl">5.0</span>,<span class="fl">30.0</span>,<span class="fl">7.1</span>)</code></pre>
<p><strong>Scalding QTree</strong></p>
<pre class="sourceCode scala"><code class="sourceCode scala">
<span class="kw">val</span> inputTp: TypedPipe[Int] = TypedPipe.<span class="fu">from</span>(List(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">30</span>))
<span class="kw">implicit</span> <span class="kw">val</span> qtSemigroup = <span class="kw">new</span> QTreeSemigroup[Long](<span class="dv">6</span>)
<span class="kw">val</span> v = inputTp.<span class="fu">map</span> {x =&gt; <span class="fu">QTree</span>(x)}.<span class="fu">groupAll</span>.<span class="fu">sum</span>.<span class="fu">values</span>

scala&gt; <span class="kw">val</span> inputTp: TypedPipe[Int] = TypedPipe.<span class="fu">from</span>(List(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">30</span>))
inputTp: com.<span class="fu">twitter</span>.<span class="fu">scalding</span>.<span class="fu">package</span>.<span class="fu">TypedPipe</span>[Int] = <span class="fu">IterablePipe</span>(List(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">30</span>))

scala&gt; <span class="kw">val</span> v = inputTp.<span class="fu">map</span> {x =&gt; <span class="fu">QTree</span>(x)}.<span class="fu">groupAll</span>.<span class="fu">sum</span>.<span class="fu">values</span>
&lt;console&gt;:<span class="dv">41</span>: error: Cannot find Semigroup <span class="kw">type</span> <span class="kw">class</span> <span class="kw">for</span> com.<span class="fu">twitter</span>.<span class="fu">algebird</span>.<span class="fu">QTree</span>[Long]
       <span class="kw">val</span> v = inputTp.<span class="fu">map</span> {x =&gt; <span class="fu">QTree</span>(x)}.<span class="fu">groupAll</span>.<span class="fu">sum</span>.<span class="fu">values</span>
                                                    ^

scala&gt; <span class="kw">implicit</span> <span class="kw">val</span> qtSemigroup = <span class="kw">new</span> QTreeSemigroup[Long](<span class="dv">6</span>)
qtSemigroup: com.<span class="fu">twitter</span>.<span class="fu">algebird</span>.<span class="fu">QTreeSemigroup</span>[Long] = com.<span class="fu">twitter</span>.<span class="fu">algebird</span>.<span class="fu">QTreeSemigroup</span>@4e92c2ed

scala&gt; <span class="kw">val</span> v = inputTp.<span class="fu">map</span> {x =&gt; <span class="fu">QTree</span>(x)}.<span class="fu">groupAll</span>.<span class="fu">sum</span>.<span class="fu">values</span>
v: com.<span class="fu">twitter</span>.<span class="fu">scalding</span>.<span class="fu">typed</span>.<span class="fu">TypedPipe</span>[com.<span class="fu">twitter</span>.<span class="fu">algebird</span>.<span class="fu">QTree</span>[Long]] = com.<span class="fu">twitter</span>.<span class="fu">scalding</span>.<span class="fu">typed</span>.<span class="fu">TypedPipeFactory</span>@<span class="fl">7925e180</span>

scala&gt; v.<span class="fu">map</span> { q =&gt; (q.<span class="fu">count</span>, q.<span class="fu">upperBound</span>, q.<span class="fu">lowerBound</span>, q.<span class="fu">quantileBounds</span>(.<span class="dv">5</span>), q.<span class="fu">quantileBounds</span>(.<span class="dv">95</span>)) }.<span class="fu">dump</span>
(<span class="dv">10</span>,<span class="fl">32.0</span>,<span class="fl">0.0</span>,(<span class="fl">4.0</span>,<span class="fl">5.0</span>),(<span class="fl">15.0</span>,<span class="fl">16.0</span>))</code></pre>
<h3 id="todo">TODO</h3>
<h4 id="analytic-window-functions-rank-ntile-laglead">Analytic / Window Functions (Rank, Ntile, Lag/Lead)</h4>
<p>Running Total, Moving Average, Sessionization</p>

</div>

</div>
</div>

</body>
</html>

