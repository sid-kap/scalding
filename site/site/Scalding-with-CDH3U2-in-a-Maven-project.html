<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
  <meta http-equiv="Content-Style-Type" content="text/css"></meta>
  <meta name="generator" content="pandoc"></meta>
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code &gt; span.kw { color: #007020; font-weight: bold; }
code &gt; span.dt { color: #902000; }
code &gt; span.dv { color: #40a070; }
code &gt; span.bn { color: #40a070; }
code &gt; span.fl { color: #40a070; }
code &gt; span.ch { color: #4070a0; }
code &gt; span.st { color: #4070a0; }
code &gt; span.co { color: #60a0b0; font-style: italic; }
code &gt; span.ot { color: #007020; }
code &gt; span.al { color: #ff0000; font-weight: bold; }
code &gt; span.fu { color: #06287e; }
code &gt; span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="http://localhost:8000/_src/css/bootstrap.min.css" type="text/css"></link>
  <link rel="stylesheet" href="http://localhost:8000/_src/css/custom.css" type="text/css"></link>
</head>
<body>

<div class="row">
    <div class="container">
        <div class="col-xs-4">
            <img id="logo" src="http://localhost:8000//_src/scalding.png">
        </div>
    </div>
</div>

<div class="container">
<div class="row">

<div class="col-xs-3" role="navigation" id="nav-left">
<ul class="nav nav-pills nav-stacked">
    <li role="presentation"><a href="http://localhost:8000/site/.Foo.md.html">.Foo</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/11.html">11</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/_Sidebar.html">_Sidebar</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/API-Reference.html">API-Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Calling-Scalding-from-inside-your-application.html">Calling-Scalding-from-inside-your-application</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Common-Exceptions-and-possible-reasons.html">Common-Exceptions-and-possible-reasons</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Comparison-to-Scrunch-and-Scoobi.html">Comparison-to-Scrunch-and-Scoobi</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Field-rules.html">Field-rules</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Fields-API:-reduce-functions-of-GroupBuilder.html">Fields-API:-reduce-functions-of-GroupBuilder</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Fields-based-API-Reference.html">Fields-based-API-Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Frequently-asked-questions.html">Frequently-asked-questions</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/hello.html">hello</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Home.html">Home</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Introduction-to-Matrix-Library.html">Introduction-to-Matrix-Library</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Matrix-API-Reference.html">Matrix-API-Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Pig-to-Scalding.html">Pig-to-Scalding</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Powered-By.html">Powered-By</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/REPL-Reference.html">REPL-Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Rosetta-Code.html">Rosetta-Code</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Run-in-Intellij-IDEA.html">Run-in-Intellij-IDEA</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scala-and-sbt-for-Homebrew-users.html">Scala-and-sbt-for-Homebrew-users</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scala-and-sbt-for-MacPorts-users.html">Scala-and-sbt-for-MacPorts-users</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scald.rb.html">Scald</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-Commons.html">Scalding-Commons</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-HBase.html">Scalding-HBase</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-on-amazon-elastic-mapreduce.html">Scalding-on-amazon-elastic-mapreduce</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-REPL.html">Scalding-REPL</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-Sources.html">Scalding-Sources</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Scalding-with-CDH3U2-in-a-Maven-project.html">Scalding-with-CDH3U2-in-a-Maven-project</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/Aggregation-using-Algebird-Aggregators.html">Aggregation-using-Algebird-Aggregators</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/Alice-in-Wonderland.html">Alice-in-Wonderland</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/Building-bigger-platforms-with-scalding.html">Building-bigger-platforms-with-scalding</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/Getting-Started.html">Getting-Started</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/Intro-to-Scalding-Jobs.html">Intro-to-Scalding-Jobs</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Tutorials/SQL-to-Scalding.html">SQL-to-Scalding</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Type-safe-api-reference.html">Type-safe-api-reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Upgrading-to-0.9.0.html">Upgrading-to-0</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Using-scalding-with-other-versions-of-scala.html">Using-scalding-with-other-versions-of-scala</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Using-the-distributed-cache.html">Using-the-distributed-cache</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Why-pack-unpack-and-not--toList[].html">Why-pack-unpack-and-not--toList[]</a>
    </li>
    <li role="presentation" class="active"><a href="#"></a></li>
</ul>
</div>

<div class="col-xs-9 text-body">

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#protocol">Protocol</a></li>
</ul>
</div>
<h3 id="introduction">Introduction</h3>
<h4 id="aim">Aim</h4>
<p>This wiki describes a procedure that should allow the dedicated reader to create an executable jar file implementing Scalding, using Maven, that is readily available for deployment on CDH3U2 cluster.</p>
<h4 id="hadoop-flavors-and-compatibility-issues">Hadoop Flavors and Compatibility Issues</h4>
<p>To deploy a MapReduce job on any Hadoop cluster, since the different Hadoop versions are not necessarily compatible with each other, one has to ensure that the core Hadoop libraries the client code uses are identical to those found throughout the entire cluster. Roughly said, client code that is planned to be deployed as an executable jar, should use the same exact jars as are used by the server nodes on the cluster. See http://www.cloudera.com/blog/2012/01/an-update-on-apache-hadoop-1-0/ for a walk down the Hadoop and Cloudera version road of chaos.</p>
<h3 id="protocol">Protocol</h3>
<h4 id="prerequisites">Prerequisites</h4>
<ul>
<li>Scalding source - here we used v0.5.3</li>
<li>SBT - to build Scalding</li>
<li>Cloudera's Hadoop (CDH) - binaries are fine, e.g. hadoop-0.20.2-cdh3u2.tar.gz . Other versions are cool, just use the same version your cluster uses.</li>
<li>IDE with Maven support - here I use Eclipse. There is no need for an IDE if you are a Maven wizard. I am not one of those.</li>
</ul>
<h4 id="procedure">Procedure</h4>
<ol style="list-style-type: decimal">
<li>CD to your Scalding source directory</li>
<li><p>Edit build.sbt to exclude the hadoop-core jar from being packaged in Scalding:</p>
<pre class="sourceCode scala"><code class="sourceCode scala">excludedJars in assembly &lt;&lt;= (fullClasspath in assembly) map { cp =&gt;
cp filter {Set(<span class="st">&quot;janino-2.5.16.jar&quot;</span>, <span class="st">&quot;hadoop-core-0.20.2.jar&quot;</span> ) contains _.<span class="fu">data</span>.<span class="fu">getName</span> }
}</code></pre>
(https://gist.github.com/238d74b081d9f2c6e5f1)</li>
<li><code>sbt -29 update</code> (-29 is a flag for SBT to build with Scala 2.9.1 libraries. Use if you intend to implement your code with this version of Scala)</li>
<li><code>sbt -29 assembly</code> (creates scalding-assembly.0.5.3.jar)</li>
<li>My own preference is to install self compiled jars in my local Maven repository. Therefore I use mvn install:install-file target (see http://maven.apache.org/plugins/maven-install-plugin/usage.html) to install the created scalding-assembly.0.5.3.jar locally. From hereon this jar's spec are <code>groupId=com.twitter artifactId=scalding-assembly version=0.5.3.cdh3u2</code></li>
<li>Download Cloudera's hadoop-0.20.2-cdh3u2.tar.gz</li>
<li>As in 5, install locally your hadoop-core-cdh3u2.jar, or alternatively you can embed Cloudera's parent pom in your project's pom (in the following steps) - they have instructions somewhere on their website)</li>
<li>In your IDE, create a new Scala project using/based on this pom: https://gist.github.com/40f1838bbdd15cc25b21</li>
<li>Create the file src/assembly/job.xml and edit: https://gist.github.com/9c5e6f04da287667983a</li>
<li>Fun part ! - Create your Scala class implementing Scalding's Job <code>class SomethingCool(args: Args) extends Job(args)</code></li>
<li><code>mvn package</code> (creates a fat jar)</li>
<li>The generated jar would be placed under your project's target folder, named like: <code>YOURPROJECT-0.0.1-SNAPSHOT-job.jar</code></li>
<li>CD to your hadoop-0.20-cdh3u2 folder</li>
<li><p>Setup your Hadoop configuration files (most importantly, your <code>conf/core-site.xml</code> file) and edit</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;property&gt;</span>
  <span class="kw">&lt;name&gt;</span>fs.default.name<span class="kw">&lt;/name&gt;</span>
  <span class="kw">&lt;value&gt;</span>hdfs://namenode.somethingcool.com:8020/<span class="kw">&lt;/value&gt;</span>
<span class="kw">&lt;/property&gt;</span></code></pre></li>
<li><p>Run</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">bin/hadoop</span> jar YOURPROJECT-0.0.1-SNAPSHOT-job.jar com.twitter.scalding.Tool your.package.your.class --hdfs --input<span class="kw">`</span> <span class="kw">`</span>hdfs://namenode.somethingcool.com/user/hdfs/tmp/hello.txt --output hdfs://namenode.somethingcool.com/user/hdfs/tmp/hello_out.txt
<span class="kw">-libjars</span> YOURPROJECT-0.0.1-SNAPSHOT-job.jar</code></pre></li>
</ol>

</div>

</div>
</div>

</body>
</html>

