<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
  <meta http-equiv="Content-Style-Type" content="text/css"></meta>
  <meta name="generator" content="pandoc"></meta>
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="http://localhost:8000/_src/css/bootstrap.min.css" type="text/css"></link>
  <link rel="stylesheet" href="http://localhost:8000/_src/css/custom.css" type="text/css"></link>
  <style type="text/css">
    table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
      margin: 0; padding: 0; vertical-align: baseline; border: none; }
    table.sourceCode { width: 100%; line-height: 100%; }
    td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
    td.sourceCode { padding-left: 5px; }
    code > span.kw { color: #007020; font-weight: bold; }
    code > span.dt { color: #902000; }
    code > span.dv { color: #40a070; }
    code > span.bn { color: #40a070; }
    code > span.fl { color: #40a070; }
    code > span.ch { color: #4070a0; }
    code > span.st { color: #4070a0; }
    code > span.co { color: #60a0b0; font-style: italic; }
    code > span.ot { color: #007020; }
    code > span.al { color: #ff0000; font-weight: bold; }
    code > span.fu { color: #06287e; }
    code > span.er { color: #ff0000; font-weight: bold; }
  </style>
</head>
<body>

<div class="row">
    <div class="container">
        <div class="col-xs-4">
            <img id="logo" src="http://localhost:8000//_src/scalding.png">
        </div>
    </div>
</div>

<div class="container">
<div class="row">

<div class="col-xs-3" role="navigation" id="nav-left">
    
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/.Foo.md.html">.Foo.md</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/11.html"></a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Home.html">Home</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/_Sidebar.html">_Sidebar</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/hello.html">hello</a>
    </li>
    </ul>
    Tutorials > Beginner
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/01-Beginner/01-Getting-Started.html">Getting Started</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/01-Beginner/02-Alice-in-Wonderland.html">Alice in Wonderland</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/01-Beginner/03-Intro-to-Scalding-Jobs.html">Intro to Scalding Jobs</a>
    </li>
    </ul>
    Tutorials > Intermediate
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/02-Intermediate/Aggregation-using-Algebird-Aggregators.html">Aggregation using Algebird Aggregators</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/02-Intermediate/SQL-to-Scalding.html">SQL to Scalding</a>
    </li>
    </ul>
    Tutorials > Advanced
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/03-Advanced/Building-bigger-platforms-with-scalding.html">Building bigger platforms with scalding</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/03-Advanced/Introduction-to-Matrix-Library.html">Introduction to Matrix Library</a>
    </li>
    </ul>
    Reference
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/02-Reference/API-Reference.html">API Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Calling-Scalding-from-Inside-Your-Application.html">Calling Scalding from Inside Your Application</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Common-Exceptions-and-Possible-Reasons.html">Common Exceptions and Possible Reasons</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Frequently-asked-questions.html">Frequently asked questions</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Matrix-API-Reference.html">Matrix API Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Pig-to-Scalding.html">Pig to Scalding</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/REPL-Reference.html">REPL Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Rosetta-Code.html">Rosetta Code</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Scald.rb.html">Scald.rb</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Scalding-Commons.html">Scalding Commons</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Scalding-HBase.html">Scalding HBase</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Scalding-REPL.html">Scalding REPL</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Scalding-Sources.html">Scalding Sources</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Type-safe-api-reference.html">Type safe api reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Using-scalding-with-other-versions-of-scala.html">Using scalding with other versions of scala</a>
    </li>
    </ul>
    Reference > Fields API (Deprecated)
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/02-Reference/01-Fields-API-(Deprecated)/Fields-API:-reduce-functions-of-GroupBuilder.html">Fields API: reduce functions of GroupBuilder</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/01-Fields-API-(Deprecated)/Fields-based-API-Reference.html">Fields based API Reference</a>
    </li>
    </ul>
    Other
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/03-Other/Comparison-to-Scrunch-and-Scoobi.html">Comparison to Scrunch and Scoobi</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Field-rules.html">Field rules</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Powered-By.html">Powered By</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Run-in-Intellij-IDEA.html">Run in Intellij IDEA</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Scala-and-sbt-for-Homebrew-users.html">Scala and sbt for Homebrew users</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Scala-and-sbt-for-MacPorts-users.html">Scala and sbt for MacPorts users</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Scalding-on-amazon-elastic-mapreduce.html">Scalding on amazon elastic mapreduce</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Scalding-with-CDH3U2-in-a-Maven-project.html">Scalding with CDH3U2 in a Maven project</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Upgrading-to-0.9.0.html">Upgrading to 0.9.0</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Using-the-distributed-cache.html">Using the distributed cache</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Why-pack-unpack-and-not--toList[].html">Why pack unpack and not  toList[]</a>
    </li>
    </ul>
</div>

<div class="col-xs-0 col-md-1"></div>

<div class="col-xs-9 col-md-8 text-body">

<div id="TOC">
<ul>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#tutorial">Tutorial</a><ul>
<li><a href="#running-on-hadoop">Running on Hadoop</a></li>
</ul></li>
</ul>
</div>
<p>In addition to production batch jobs, Scalding can be run interactively to help develop ad-hoc queries or give beginners a chance to learn about the platform step-by-step.</p>
<p>The Tutorial will walk through using the REPL in depth. Users already familiar with Scalding may wish to skip to the summary of REPL functionality below.</p>
<h3 id="quick-start">Quick Start</h3>
<p>Starting up the REPL in local mode is as easy as:</p>
<pre class="sourceCode scala"><code class="sourceCode scala">> ./sbt <span class="st">"scalding-repl/run --local"</span></code></pre>
<p>To run full HDFS mode on a remote machine, you must build the assembly jar and use the <code>scald.rb</code> script to rsync and ssh to the right machine:</p>
<pre class="sourceCode scala"><code class="sourceCode scala">> ./sbt assembly
> ./scripts/scald.<span class="fu">rb</span> --repl --hdfs --host <host to ssh to and launch jobs from></code></pre>
<h2 id="tutorial">Tutorial</h2>
<p>Assuming you've checked out the Scalding code, the fastest way to start running Scalding is to launch the REPL in Local mode. Simply run:</p>
<pre><code>> ./sbt "scalding-repl/run --local"</code></pre>
<p>It will spend some time downloading and compiling, but should eventually show:</p>
<pre class="sourceCode scala"><code class="sourceCode scala">[info] Set current project to <span class="fu">scalding</span> (in build file:/Users/bholt/hub/scalding/)
<span class="kw">import</span> com.<span class="fu">twitter</span>.<span class="fu">scalding</span>.<span class="fu">_</span>
<span class="kw">import</span> com.<span class="fu">twitter</span>.<span class="fu">scalding</span>.<span class="fu">ReplImplicits</span>.<span class="fu">_</span>
<span class="kw">import</span> com.<span class="fu">twitter</span>.<span class="fu">scalding</span>.<span class="fu">ReplImplicitContext</span>.<span class="fu">_</span>
...
scalding> </code></pre>
<p>As you can see, we've imported a bunch of Scalding code, including implicits that make it easier to run jobs interactively. Several of these enhancements are "enrichments" on Scalding's <code>TypedPipe</code>. The tutorial will go into them in more detail.</p>
<p>Let's take a look at some.</p>
<h4 id="viewing-pipe-contents">Viewing pipe contents</h4>
<p>First, <code>dump</code> allows you to print what's in a TypedPipe:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="co">// load a plain text file into a TypedPipe</span>
scalding> <span class="kw">val</span> hello = TypedPipe.<span class="fu">from</span>(<span class="fu">TextLine</span>(<span class="st">"tutorial/data/hello.txt"</span>))
hello: TypedPipe[String] = <span class="fu">TypedPipeInst</span>(<span class="co">/*...tutorial/data/hello.txt...*/</span>)

scalding> hello.<span class="fu">dump</span>
Hello world
Goodbye world</code></pre>
<p>We can also load the contents into memory as a list:</p>
<pre class="sourceCode scala"><code class="sourceCode scala">scalding> <span class="kw">val</span> lst = hello.<span class="fu">toList</span>
lst: List[String] = List(Hello world, Goodbye world)</code></pre>
<p>In fact, both <code>dump</code> and <code>toList</code> use another TypedPipe enrichment, <code>toIterator</code>, which can be used directly if one wishes to stream over the data and perform some operation.</p>
<p>Remember that each of these operations run <em>locally</em>, so if you <em>are</em> actually working with large datasets, ensure that you do most of your work using TypedPipe operations, which will run through Cascading/Hadoop, and only call <code>toIterator</code> (or <code>dump</code>, or <code>toList</code>) once you've filtered the results sufficiently. Some helpful TypedPipe operations to downsize datasets are <code>limit</code> and <code>sample</code>.</p>
<h4 id="save">Save</h4>
<p>Usually in Scalding, results are written to a Sink using <code>.write()</code>. However, the write only happens when the flow is actually run. That way you can build up a complicated flow with multiple sources and sinks and intermediate calculations and run it as one big job. When running interactively, however, we want a way to immediately run part of a job to see if it's correct before moving on. When running in the REPL, <code>save</code> can be used in place of <code>write</code> to immediately run that pipe and write out the results.</p>
<pre class="sourceCode scala"><code class="sourceCode scala">scalding> <span class="kw">val</span> hello = TypedPipe.<span class="fu">from</span>(<span class="fu">TextLine</span>(<span class="st">"tutorial/data/hello.txt"</span>))
hello: TypedPipe[String] = <span class="fu">TypedPipeInst</span>(<span class="co">/*...tutorial/data/hello.txt...*/</span>)

scalding> <span class="kw">val</span> words = hello.<span class="fu">flatMap</span>(_.<span class="fu">split</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">s+"</span>)).<span class="fu">save</span>(<span class="fu">TypedTsv</span>(<span class="st">"words.tsv"</span>))
INFO flow.<span class="fu">Flow</span>: [ScaldingShell] starting
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  source: FileTap[<span class="st">"tutorial/data/hello.txt"</span>]
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  sink: FileTap[<span class="st">"words.tsv"</span>]
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  parallel execution is enabled: <span class="kw">true</span>
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  starting jobs: <span class="dv">1</span>
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  allocating threads: <span class="dv">1</span>
INFO flow.<span class="fu">FlowStep</span>: [ScaldingShell] starting step: local
words: TypedPipe[String] = <span class="co">/* FixedPathTypedDelimited(List(words.tsv)) */</span></code></pre>
<p>Conviently, this returns a new pipe reading from the file which can be used in subsequent computations.</p>
<h4 id="snapshots">Snapshots</h4>
<p>When working interactively with large datasets, it is often useful to be able to save and re-use data that took significant work to generate. The Scalding REPL provides an easy way to explicitly save intermediate results and use these results in subsequent interactive work.</p>
<p>The <code>snapshot</code> enrichment on TypedPipe runs everything necessary to generate the output for the given pipe and saves it to temporary storage. In Local mode, it actually just saves it in memory; in Hadoop, it writes it out to a temporary SequenceFile. Scalding then returns a handle to this new Source as a new TypedPipe.</p>
<p>Snapshots should only be used within a single REPL session. In local mode, you have no choice because they only exist in memory. But even for Hadoop mode, it is not a good idea to try to re-use generated snapshots, as Kryo serialization is unstable and the temporary files may be cleaned up when not in use.</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="co">// (using 'hello' TypedPipe declared above)</span>
<span class="co">// split into words, returns TypedPipe all set to do the work (but not run yet)</span>
scalding> <span class="kw">val</span> words = hello.<span class="fu">flatMap</span>(_.<span class="fu">split</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">s+"</span>)).<span class="fu">map</span>(_.<span class="fu">toLowerCase</span>)
words: TypedPipe[String] = <span class="fu">TypedPipeInst</span>(<span class="co">/*...tutorial/data/hello.txt...*/</span>)

<span class="co">// save a snapshot</span>
scalding> <span class="kw">val</span> s = words.<span class="fu">snapshot</span>
INFO flow.<span class="fu">Flow</span>: [ScaldingShell] starting
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  source: FileTap[<span class="st">"tutorial/data/hello.txt"</span>]
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  sink: MemoryTap
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  parallel execution is enabled: <span class="kw">true</span>
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  starting jobs: <span class="dv">1</span>
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  allocating threads: <span class="dv">1</span>
INFO flow.<span class="fu">FlowStep</span>: [ScaldingShell] starting step: local
s: TypedPipe[String] = <span class="fu">IterablePipe</span>(<span class="co">/*...*/</span>)

<span class="co">// now take a look at what's in the snapshot</span>
scalding> s.<span class="fu">dump</span>
hello
world
goodbye
world</code></pre>
<p>You can see to create the snapshot, it ran a small Cascading job, and returned a TypedPipe with the result to us. Now, rather than spending that enormous amount of time to re-generate "words", we can use <code>s</code>, our snapshot, to, for a change, count some words:</p>
<pre class="sourceCode scala"><code class="sourceCode scala">scalding> <span class="kw">val</span> wordCount = s.<span class="fu">map</span>((_, <span class="dv">1</span>)).<span class="fu">sumByKey</span>
wordCount: UnsortedGrouped[String,Int] = <span class="co">/*...*/</span>

scalding> wordCount.<span class="fu">snapshot</span>.<span class="fu">dump</span>
INFO flow.<span class="fu">Flow</span>: [ScaldingShell] starting
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  source: MemoryTap
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  sink: MemoryTap
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  parallel execution is enabled: <span class="kw">true</span>
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  starting jobs: <span class="dv">1</span>
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  allocating threads: <span class="dv">1</span>
INFO flow.<span class="fu">FlowStep</span>: [ScaldingShell] starting step: local
(goodbye,<span class="dv">1</span>)
(hello,<span class="dv">1</span>)
(world,<span class="dv">2</span>)</code></pre>
<p>Notice above how running <code>wordCount</code> with <code>snapshot</code> used the MemoryTap (snapshot) created before as its source. If, instead, we wanted to run the entire job end-to-end, we simply need to bypass the snapshots and use the original pipes:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="co">// remember, 'words' was a TypedPipe which reads from the original text file</span>
scalding> words
res0: TypedPipe[String] = <span class="co">/*... TextLineWrappedArray(tutorial/data/hello.txt) */</span>
scalding> words.<span class="fu">map</span>((_, <span class="dv">1</span>)).<span class="fu">sumByKey</span>.<span class="fu">dump</span>
INFO flow.<span class="fu">Flow</span>: [ScaldingShell] starting
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  source: FileTap[<span class="st">"tutorial/data/hello.txt"</span>]
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  sink: MemoryTap
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  parallel execution is enabled: <span class="kw">true</span>
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  starting jobs: <span class="dv">1</span>
INFO flow.<span class="fu">Flow</span>: [ScaldingShell]  allocating threads: <span class="dv">1</span>
INFO flow.<span class="fu">FlowStep</span>: [ScaldingShell] starting step: local
(goodbye,<span class="dv">1</span>)
(hello,<span class="dv">1</span>)
(world,<span class="dv">2</span>)</code></pre>
<p>See, that time the "source" was the original text file.</p>
<h5 id="implicit-snapshots">Implicit snapshots</h5>
<p>The previous example actually pulled out a subtle additional trick. Calling <code>dump</code> on the result of <code>sumByKey</code> ran the flow <em>and</em> printed the results. Because you may be dealing with large datasets, we want to run these pipes using Cascading in Hadoop. The <code>toIterator</code> method, which is called by <code>dump</code>, doesn't want to have to iterate over excessively large datasets locally, so it calls <code>snapshot</code>, which runs the flow in Cascading, and then <code>toIterator</code> can iterate over the snapshot. However, each call to <code>dump</code> as above will need to re-run, because we aren't keeping a handle to the snapshot around. If a flow is taking a while to run, try saving the results to a snapshot first, then using that snapshot to further understand the data.</p>
<h3 id="running-on-hadoop">Running on Hadoop</h3>
<p>So far, we've only been running in Cascading's Local mode, which emulates what Hadoop will do, but cannot handle actually large datasets. The easiest way to launch the REPL in Hadoop mode is to use the <code>scald.rb</code> script.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co"># must first create the massive assembly jar with all the code</span>
<span class="kw">scalding</span>$ ./sbt assembly
<span class="co"># then launch the REPL</span>
<span class="kw">scalding</span>$ ./scripts/scald.rb --repl --hdfs</code></pre>

</div>

</div>
</div>

</body>
</html>
