<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
  <meta http-equiv="Content-Style-Type" content="text/css"></meta>
  <meta name="generator" content="pandoc"></meta>
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="http://localhost:8000/_src/css/bootstrap.min.css" type="text/css"></link>
  <link rel="stylesheet" href="http://localhost:8000/_src/css/custom.css" type="text/css"></link>
  <style type="text/css">
    table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
      margin: 0; padding: 0; vertical-align: baseline; border: none; }
    table.sourceCode { width: 100%; line-height: 100%; }
    td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
    td.sourceCode { padding-left: 5px; }
    code > span.kw { color: #007020; font-weight: bold; }
    code > span.dt { color: #902000; }
    code > span.dv { color: #40a070; }
    code > span.bn { color: #40a070; }
    code > span.fl { color: #40a070; }
    code > span.ch { color: #4070a0; }
    code > span.st { color: #4070a0; }
    code > span.co { color: #60a0b0; font-style: italic; }
    code > span.ot { color: #007020; }
    code > span.al { color: #ff0000; font-weight: bold; }
    code > span.fu { color: #06287e; }
    code > span.er { color: #ff0000; font-weight: bold; }
  </style>
</head>
<body>

<div class="row">
    <div class="container">
        <div class="col-xs-4">
            <img id="logo" src="http://localhost:8000//_src/scalding.png">
        </div>
    </div>
</div>

<div class="container">
<div class="row">

<div class="col-xs-3" role="navigation" id="nav-left">
    
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/.Foo.md.html">.Foo.md</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/11.html"></a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/Home.html">Home</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/_Sidebar.html">_Sidebar</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/hello.html">hello</a>
    </li>
    </ul>
    Tutorials > Beginner
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/01-Beginner/01-Getting-Started.html">Getting Started</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/01-Beginner/02-Alice-in-Wonderland.html">Alice in Wonderland</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/01-Beginner/03-Intro-to-Scalding-Jobs.html">Intro to Scalding Jobs</a>
    </li>
    </ul>
    Tutorials > Intermediate
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/02-Intermediate/Aggregation-using-Algebird-Aggregators.html">Aggregation using Algebird Aggregators</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/02-Intermediate/SQL-to-Scalding.html">SQL to Scalding</a>
    </li>
    </ul>
    Tutorials > Advanced
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/03-Advanced/Building-bigger-platforms-with-scalding.html">Building bigger platforms with scalding</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/01-Tutorials/03-Advanced/Introduction-to-Matrix-Library.html">Introduction to Matrix Library</a>
    </li>
    </ul>
    Reference
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/02-Reference/API-Reference.html">API Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Calling-Scalding-from-Inside-Your-Application.html">Calling Scalding from Inside Your Application</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Common-Exceptions-and-Possible-Reasons.html">Common Exceptions and Possible Reasons</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Frequently-asked-questions.html">Frequently asked questions</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Matrix-API-Reference.html">Matrix API Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Pig-to-Scalding.html">Pig to Scalding</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/REPL-Reference.html">REPL Reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Rosetta-Code.html">Rosetta Code</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Scald.rb.html">Scald.rb</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Scalding-Commons.html">Scalding Commons</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Scalding-HBase.html">Scalding HBase</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Scalding-REPL.html">Scalding REPL</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Scalding-Sources.html">Scalding Sources</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Type-safe-api-reference.html">Type safe api reference</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/Using-scalding-with-other-versions-of-scala.html">Using scalding with other versions of scala</a>
    </li>
    </ul>
    Reference > Fields API (Deprecated)
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/02-Reference/01-Fields-API-(Deprecated)/Fields-API:-reduce-functions-of-GroupBuilder.html">Fields API: reduce functions of GroupBuilder</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/02-Reference/01-Fields-API-(Deprecated)/Fields-based-API-Reference.html">Fields based API Reference</a>
    </li>
    </ul>
    Other
    <ul class="nav nav-pills nav-stacked"><li role="presentation"><a href="http://localhost:8000/site/03-Other/Comparison-to-Scrunch-and-Scoobi.html">Comparison to Scrunch and Scoobi</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Field-rules.html">Field rules</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Powered-By.html">Powered By</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Run-in-Intellij-IDEA.html">Run in Intellij IDEA</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Scala-and-sbt-for-Homebrew-users.html">Scala and sbt for Homebrew users</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Scala-and-sbt-for-MacPorts-users.html">Scala and sbt for MacPorts users</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Scalding-on-amazon-elastic-mapreduce.html">Scalding on amazon elastic mapreduce</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Scalding-with-CDH3U2-in-a-Maven-project.html">Scalding with CDH3U2 in a Maven project</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Upgrading-to-0.9.0.html">Upgrading to 0.9.0</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Using-the-distributed-cache.html">Using the distributed cache</a>
    </li>
    <li role="presentation"><a href="http://localhost:8000/site/03-Other/Why-pack-unpack-and-not--toList[].html">Why pack unpack and not  toList[]</a>
    </li>
    </ul>
</div>

<div class="col-xs-9 text-body">

<div id="TOC">
<ul>
<li><a href="#some-rules">Some rules</a></li>
<li><a href="#running-existing-jobs-inside-a-library">Running Existing Jobs Inside A Library</a><ul>
<li><a href="#working-example">Working example:</a></li>
</ul></li>
</ul>
</div>
<p>Starting in scalding 0.12, there is a clear API for doing this. See <code>Execution[T]</code>, which describes a set of map/reduce operations that when executed return a <code>Future[T]</code>. See the <a href="http://twitter.github.io/scalding/#com.twitter.scalding.Execution">scaladocs for Execution</a>. Below is an example.</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> job: Execution[Unit] =
  TypedPipe.<span class="fu">from</span>(<span class="fu">TextLine</span>(<span class="st">"input"</span>))
    .<span class="fu">flatMap</span>(_.<span class="fu">split</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">s+"</span>))
    .<span class="fu">map</span> { word => (word, 1L) }
    .<span class="fu">sumByKey</span>
    .<span class="fu">writeExecution</span>(<span class="fu">TypedTsv</span>(<span class="st">"output"</span>))
<span class="co">// Now we run it in Local mode</span>
<span class="kw">val</span> u: Unit = job.<span class="fu">waitFor</span>(Config.<span class="fu">default</span>, <span class="fu">Local</span>(<span class="kw">true</span>))

<span class="co">// Or for Hadoop:</span>
<span class="kw">val</span> jobConf = <span class="kw">new</span> JobConf
<span class="kw">val</span> u: Unit = job.<span class="fu">waitFor</span>(Config.<span class="fu">hadoopWithDefaults</span>(jobConf), <span class="fu">Hdfs</span>(jobConf, <span class="kw">true</span>))
<span class="co">// If you want to be asynchronous, use run instead of waitFor and get a Future in return</span></code></pre>
<p>For testing or cases where you aggregate data down to a manageable level, <code>.toIterableExecution</code> on TypedPipe is very useful:</p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> job: Execution[Iterable[(String, Long)]] =
  TypedPipe.<span class="fu">from</span>(<span class="fu">TextLine</span>(<span class="st">"input"</span>))
    .<span class="fu">flatMap</span>(_.<span class="fu">split</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">s+"</span>))
    .<span class="fu">map</span> { word => (word, 1L) }
    .<span class="fu">sumByKey</span>
    .<span class="fu">toIterableExecution</span>
<span class="co">// Now we run it in Local mode</span>
<span class="kw">val</span> counts: Map[String, Long] = job.<span class="fu">waitFor</span>(Config.<span class="fu">default</span>, <span class="fu">Local</span>(<span class="kw">true</span>)).<span class="fu">toMap</span></code></pre>
<p>To run an Execution as a stand-alone job, see:</p>
<ol style="list-style-type: decimal">
<li><a href="https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/ExecutionApp.scala#L75">ExecutionApp</a> Make an <code>object MyExJob extends ExecutionApp</code> for a job you can run like a normal java application (by using java on the classname).</li>
<li><a href="https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/Job.scala#L441">ExecutionJob</a> - use this only if you have an existing tooling around launching scalding.Job subclasses.</li>
</ol>
<h2 id="some-rules">Some rules</h2>
<ol style="list-style-type: decimal">
<li><p>When using Execution NEVER use <code>.write</code> or <code>.toPipe</code> (or call any method that takes an implicit flowDef). Instead use <code>.writeExecution</code>, <code>.toIterableExecution</code>, or <code>.forceToDiskExecution</code>. (see <a href="http://twitter.github.io/scalding/#com.twitter.scalding.Execution">scaladocs</a>).</p></li>
<li><p>Avoid calling <code>.waitFor</code> or <code>.run</code> AS LONG AS POSSIBLE. Try to compose your entire job into on large Execution using <code>.zip</code> or <code>.flatMap</code> to combine <code>Executions</code>. <code>waitFor</code> is the same as <code>run</code> except it waits on the future. There should be at most 1 calling to .waitFor or .run in each Execution App/Job.</p></li>
<li><p>Only mutate vars or perform side effects using <code>.onComplete</code>. If you <code>run</code> the result of <code>onComplete</code>, your function you pass will be run when the result up to that point is available and you will get the <code>Try[T]</code> for the result. Avoid this if possible. It is here to deal with external IO, or existing APIs, and designed for experts that are comfortable using .onComplete on scala Futures (which is all this method is doing under the covers).</p></li>
</ol>
<h2 id="running-existing-jobs-inside-a-library">Running Existing Jobs Inside A Library</h2>
<p>We recommend the above approach to build composable jobs with Executions. But if you have an existing Job, you can also run that:</p>
<h3 id="working-example">Working example:</h3>
<p><strong>WordCountJob.scala</strong></p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">class</span> <span class="fu">WordCountJob</span>(args: Args) <span class="kw">extends</span> <span class="fu">Job</span>(args) {
  <span class="fu">TextLine</span>(<span class="fu">args</span>(<span class="st">"input"</span>))
    .<span class="fu">read</span>
    .<span class="fu">flatMap</span>('line -> 'word) { line: String => line.<span class="fu">split</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">s+"</span>) }
    .<span class="fu">groupBy</span>('word) { _.<span class="fu">size</span> }
    .<span class="fu">write</span>(<span class="fu">Tsv</span>(<span class="fu">args</span>(<span class="st">"output"</span>)))
}</code></pre>
<p><strong>Runner.scala</strong></p>
<pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">object</span> Runner <span class="kw">extends</span> App {
  <span class="kw">val</span> hadoopConfiguration: Configuration = <span class="kw">new</span> Configuration
  hadoopConfiguration.<span class="fu">set</span>(<span class="st">"mapred.job.tracker"</span>,<span class="st">"hadoop-master:8021"</span>)
  hadoopConfiguration.<span class="fu">set</span>(<span class="st">"fs.defaultFS"</span>,<span class="st">"hdfs://hadoop-master:8020"</span>)

  <span class="kw">val</span> hdfsMode = <span class="fu">Hdfs</span>(strict = <span class="kw">true</span>, hadoopConfiguration)
  <span class="kw">val</span> arguments = Mode.<span class="fu">putMode</span>(hdfsMode, <span class="fu">Args</span>(<span class="st">"--input in.txt --output counts.tsv"</span>))

  <span class="co">// Now create the job after the mode is set up properly.</span>
  <span class="kw">val</span> job: WordCountJob = <span class="kw">new</span> <span class="fu">WordCountJob</span>(arguments)
  <span class="kw">val</span> flow = job.<span class="fu">buildFlow</span>
  flow.<span class="fu">complete</span>()
}</code></pre>
<p>And then you can run your App on any server, that have access to Hadoop cluster</p>

</div>

</div>
</div>

</body>
</html>
